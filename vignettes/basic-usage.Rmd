---
title: "Basic usage of edfinr"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Basic usage of edfinr}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

To use the `edfinr` package to access district-level school finance data, start by loading the package.

```{r setup}
library(edfinr)
```

The primary function in `edfinr` is `get_finance_data`, which allows users to download school finance data from school years 2011-12 through 2021-22. District-level revenue, expenditure, and enrollment data come from the National Center for Education Statistics (NCES) F-33 survey. Additional data are drawn from the NCES Common Core of Data Directory file (via the Urban Institute's `educationdata` package), along with the U.S. Census Bureau's 5-Year American Community Survey (via the `tidycensus` package) and Small Area Income and Poverty Estimates (SAIPE). Inflation is indexed using the U.S. Bureau of Labor Statistics Consumer Price Index for All Urban Consumers (CPI-U). 

Basic usage of `get_finance_data` starts with specifying the years and geographies of data you'd like to explore. Here's a simple example that will return finance data for Kentucky school districts from the 2015-16 school year:
```{r example-1}
ky_sy16 <- get_finance_data(yr = 2016, geo = "KY")
```

By default, `get_finance_data` returns a tibble with 41 columns. More detailed expenditure data can be added by adjusting the `dataset_type` parameter from its default (`"skinny"`) to `"full"`. This will return a tibble with 48 additional expenditure variables for a total of 89 columns.

```{r example-2}
ky_full_sy16 <- get_finance_data(yr = "2016", geo = "KY", dataset_type = "full")

```

It's straighforward to access data from multiple years and/or states with `get_finance_data`. This example will return all available years of data for each state with a university in the Southeastern Conference:

```{r example-3}
sec_sy12_thru_sy22 <- get_finance_data(yr = "2016:2022", geo = "AL,AR,FL,GA,KY,LA,MS,MO,OK,SC,TN,TX")
```


### Working with the Data

```{r}
library(tidyverse)

# basic analysis with skinny dataset
get_finance_data(yr = "2022", geo = "KY") |>
  select(dist_name, enroll, rev_total_pp, exp_cur_pp) |>
  arrange(desc(rev_total_pp)) |>
  head(10)

# analysis with full dataset - examining detailed expenditures
get_finance_data(yr = "2022", geo = "KY", dataset_type = "full") |>
  select(ncesid, state, dist_name, enroll, exp_covid_total) |>
  filter(!is.na(exp_covid_total)) |>
  mutate(exp_covid_total_pp = exp_covid_total / enroll) |>
  arrange(desc(exp_covid_total_pp))

```